$Id: README,v 1.1 2002/02/14 20:09:16 bwess Exp $

fwlogwatch is a security tool written in C by Boris Wesslowski for the
RUS-CERT. It is a linux ipchains packet filter log analyzer with incident
report and realtime response capability.

It is available from http://www.kyb.uni-stuttgart.de/boris/software.shtml
for now and will be on the RUS-CERT website http://cert.uni-stuttgart.de soon.


FEATURES
- Log summary mode:
  - A lot of options to find and display relevant patterns in connection
    attempts.
  - Intelligent selection of certain fields (e.g. the host name column is
    omitted and the host mentioned in the header of the summary if the
    log is from a single host, the same happens with the chains, targets
    and interfaces).
  - Can separate recent from old entries and detects timewarps in log files.
  - Plain text and html output.
  - Integrated resolver for protocols, services and host names.
  - Own dns cache for faster lookups.

- Interactive report mode:
  - The integrated report generator fills and presents a
    report that can be sent to abuse contacts of attacking sites or
    computer emergency response and coordination centers (CERT/CC).
  - Supports templates and incident number generation.
  - All fields can be adjusted as needed interactively.

- Realtime response mode:
  - The program detaches and stays in the background as a daemon.
  - It detects if the necessary ipchains rules with logging turned on exist.
  - Response can be a notification (in form of a log file entry or a remote
    winpopup message), a firewall modification or anything you can invoke
    in a shell.
  - In block mode a new chain for fwlogwatch is added and attackers are
    completely blocked with new firewall rules. Supports trusted hosts
    (anti-spoof).

The commented config file supports and explains all options and will get
you started quickly.


BASICS
- Create an ipchains packet filter with allow rules for all connections you
  need, as tight as possible.

- Your default policy should be DENY:

    ipchains -P input DENY
    ipchains -P forward DENY

  although they won't be needed since all unallowed traffic
  will be intercepted by the following logging rules:

    ipchains -A input -l -j DENY
    ipchains -A forward -l -j DENY

  so the last line in your input, forward and custom chains should be

    target     prot opt     source                destination           ports
    DENY       all  ----l-  anywhere              anywhere              n/a

- You can also specify rules for the output chain but you should use the
  target REJECT (you/your users will notice faster what the problem is when
  trying something the policy forbids).

- If you have a persistent log spammer drop his packets by inserting a DENY
  rule before the logging rule above (or use the block response mode).


INSTALLATION
A simple 'make' should be enough to obtain a working binary. If you use
the realtime response mode or access the standard messages file you will
need to install fwlogwatch with superuser permissions. 'make install'
will put the binary in /usr/local/sbin, and the config file and a sample
template in /etc.

You can define the TMPDIR environment variable if you don't want fwlogwatch
to create it's temporary files in /tmp/.


CONFIGURATION AND EXAMPLES
- You should make a config file for each function you want, look at the
  included sample file, it should be easy to adapt it to your needs.

- If you want a html summary 'log.html' of all packet filter entries at
  most one day old from the file 'messages' with timestamps, time intervals,
  resolved ip addresses and service names and with connections separated by
  protocol, source and destination ports and tcp options you would use

    fwlogwatch -v -v -s -d -t -z -y -n -p -w -l 1d -o log.html -f messages

- If you want to use fwlogwatch as a CGI, e.g. to have a quick look at
  what happened in the last hour when you get a notification:
  Copy the file fwlogwatch.small.cgi to a place where your web server
  can execute it (fwlogwatch must be reachable and have enough
  permissions to read the log file, e.g. setgid root).

- A script for generation of 8 general summaries is also included, use
  it as 'fwlogsummary.cgi [logfile]' (it will use the output directory
  /home/httpd/html/fwlogwatch as default) and look at the index.html file
  to select the level of detail you need.

- You might want to replace your /etc/services file by the one supplied
  with nmap, a lot more services will be recognized, you can also add the
  icmp types (don't assign one to 0 since it is the ipchains default).


FEEDBACK
If you find a bug or have an idea for a new feature please send an email
to boris.wesslowski@rus.uni-stuttgart.de

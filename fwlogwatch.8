.\"
.\" $Id: fwlogwatch.8,v 1.8 2002/02/14 20:54:34 bwess Exp $
.\"
.TH FWLOGWATCH 8 "26 December 2000" RUS-CERT
.SH NAME
fwlogwatch \- a firewall log analyzer, report generator and realtime response agent
.SH SYNOPSIS
.B fwlogwatch
.RI [ options ]
.SH DESCRIPTION
.B fwlogwatch
produces ipchains, netfilter/iptables and cisco log summary reports in text
and HTML form and has a lot of options to find and display relevant
patterns in connection attempts. With the data found it can produce
customizable incident reports from a template and send them to abuse
contacts at offending sites or CERT coordination centers. Finally, it can
also run as daemon and report anomalies or start countermeasures.

.SH OPTIONS
The global options for all modes (at least where they make sense) are:
.IP \-c\ \fIconfig\fR
Use the alternate configuration file
.IR config .
If you use the default configuration file
.B /etc/fwlogwatch.config
command line parameters override
the options specified in the file. If you specify an alternate configuration
file only options not specified in the file can be overridden by command line
options.
.IP \-D
Do not differentiate destination IP addresses. Useful for finding scans in
whole subnets.
.IP \-d
Differentiate destination ports.
.IP \-f\ \fIfile\fR
Specify an input file (defaults to
.B /var/log/messages
). Relevant entries are automatically detected so combined log files (e.g.
from a log host) are no problem.
.IP \-h
Show the available options.
.IP \-L
Show time of the first and the last log entry in the input file. Use the
option -f to specify other input file than the default one.
.IP \-l\ \fItime\fR
Process recent events only. See
.B TIME FORMAT
below for the time options.
.IP \-n
Enable DNS lookups. Host names will be resolved (reverse and forward lookup
with a warning if they don't match). This makes summary generation very
slow if a lot of different hosts appear in the log file.
.IP \-p
Differentiate protocols. This is activated automatically if you
differentiate source and/or destination ports.
.IP \-S
Do not differentiate source IP addresses.
.IP \-s
Differentiate source ports.
.IP \-t
Show start and end times of connection attempts. End times are only
available if the connection attempt entry consists of more than one packet.
.IP \-V
Show version and copyright information.
.IP \-v
Be verbose. You can specify it twice for more information.
In very verbose mode while parsing the log file you will see "." for
relevant packet filter log entries, "o" for packet filter log entries that
are too old and "_" for entries that are not packet filter logs.
.IP \-y
Differentiate TCP options (SYN/ACK). All connections with a SYN are listed
separately, other TCP flags are not available because ipchains and cisco
don't log them (netfilter does, cisco doesn't even log SYNs).
.IP \-z
Show time interval between start and end time of connection attempts. This
is only available if the connection attempt entry consists of more than one
packet.
.SH "LOG SUMMARY MODE"
This are additional options that are only available in log summary mode:
.IP \-m\ \fIcount\fR
When analyzing large logfiles you usually aren't interested in entries that
have a small count. You can hide entries below a certain threshold with
this option.
.IP \-o\ \fIfile\fR
Specify an output file.
.IP \-O\ \fIorder\fR
This is the sort order of the summary. Since entries often are
equal in certain fields you can sort by several fields one after another
(the sort algorithm is stable, so equal entries will remain sorted in the
order they were sorted before). The sort string can be composed of up to 8
fields of the form
.B ab
where
.B a
is the sort criteria:
.I c
count,
.I S
source host,
.I D
destination host,
.I s
source port,
.I t
start time and
.I z
duration.
.B b
is the direction:
.I a
ascending and
.I d
descending.
Sorting is done in the order specified, so the last option is the primary
criteria. The default is
.I tacd
(start with the highest count, if two counts match list the one earlier in
time first). If you specify an empty sort string or everything else is equal
entries will be unsorted (as they come in the log file with the most recent
unique entry found first).
.IP \-w
Produce output in HTML format.
.SH "INTERACTIVE REPORT MODE"
.IP \-i\ \fIcount\fR
Enter interactive report mode.
.I count
is the minimum number of log entries you want to start reporting at. A
summary of the corresponding entries will be shown and a report generated
for each one. The more of the options above you use the more fields of the
report will be filled in.
.IP \-F\ \fIemail\fR
This is the address the email containing the report will be sent from.
.IP \-T\ \fIemail\fR
This is the email address of the abuse contact or CERT the report will be
sent to.
.IP \-C\ \fIemail\fR
These email recipients will get a carbon copy of the report (e.g. for your
archives).
.IP \-I\ \fIfile\fR
Template file for report (defaults to
.B /etc/fwlogwatch.template
).
.SH "REALTIME RESPONSE MODE"
.IP \-R
Enter realtime response mode. This means: detach, check if the firewall is
configured correctly and run as daemon until the SIGTERM signal (kill) is
received. All output can be followed in the system log.
.IP \-a\ \fIcount\fR
Alert threshold. Notify or start countermeasures if this limit is reached.
Defaults to 5.
.IP \-l\ \fItime\fR
Forget events that happened this long ago (defaults to 1 day). See
.B TIME FORMAT
below for the time options.
.IP \-k\ \fIIP\fR
This option defines a host that will never be blocked or other actions taken
against. To specify more than one, use the -k parameter again for each IP
address you want to add.
.IP \-M\ \fIemail\fR
Send an email notification to the specified
.I email
address.
.IP \-B
Block host completely with new firewall rule. A new chain for
.B fwlogwatch
actions is inserted in the input chain and block rules added as needed.
The chain and its content is removed if
.B fwlogwatch
is terminated normally.
.IP \-W\ \fIhost\fR
Send a winpopup alert message to the windows machine
.IR host .
.IP \-A\ \fIaction\fR
This custom
.I action
is executed in a shell.
.IP \-X
Activate the internal web server to monitor the current status of the program.
Use the configuration file to change it's options. The default user name is
.B admin
and the default password is
.B fwlogwat
since DES can only encrypt 8 characters. By default it listens on port
888 and only allows connections from localhost.
.SH "TIME FORMAT"
Time is specified as
.B nx
where
.B n
is a natural number and
.B x
is one of the
following:
.I s
for seconds (default if you don't specify anything),
.I m
for minutes,
.I h
for hours,
.I d
for days,
.I w
for weeks,
.I M
for months and
.I y
for years.
.SH FILES
.IP \fB/etc/fwlogwatch.config\fR
Default configuration file.
.IP \fB/etc/fwlogwatch.template\fR
Default template for incident reports.
.IP \fB/var/log/messages\fR
Default input log file.
.SH "FEATURES ONLY IN CONFIGURATION FILE"
The following features are only available in the configuration file and not
on the command line, they are presented and explained in the sample
configuration file.
.IP HTML\ colors
The colors of the HTML output page can be customized.
.IP status\ server\ options
The host that can access the web interface, the port it listens to and the
user and password can be changed.
.SH NETFILTER AND CISCO SUPPORT
fwlogwatch also features iptables/netfilter and cisco log file support, it can
even parse combined log files. Some restrictions apply because not all fields
exist or make sense in all log file types. Realtime response mode only works
for ipchains.
.SH SECURITY
Since
.B fwlogwatch
is a security tool and needs superuser permissions for certain tasks
special care was taken to make it secure. You can run it with user
permissions for most functions or you can make it setgid for a
group
.B /var/log/messages
is in if all you need is to be able to read this file. Only the realtime
response mode needs superuser permissions to analyze (and in block mode
also modify) the firewall rules.
.SH AUTHOR
Boris Wesslowski <Boris.Wesslowski@RUS.Uni-Stuttgart.DE>,
RUS-CERT http://cert.uni-stuttgart.de
